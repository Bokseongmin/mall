<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mShop">

	<!-- 목록 1차 -->
	<select id="list_1" resultType="GoodsViewVo">
		SELECT g.gdsNum, g.gdsName, g.cateCode, g.gdsImg, g.gdsThumbImg, c.cateCodeRef, c.cateName, gdsPrice, gdsStock, gdsDes, gdsImg, gdsDate
		FROM goods g
		INNER JOIN goods_category c
		ON g.cateCode = c.cateCode
		WHERE g.cateCode = #{cateCode}
		OR c.cateCodeRef = #{cateCodeRef}
	</select>
	
	<!-- 목록 2차 -->
	<select id="list_2" resultType="GoodsViewVo">
		SELECT g.gdsNum, g.gdsName, g.cateCode, g.gdsImg, g.gdsThumbImg, c.cateCodeRef, c.cateName, gdsPrice, gdsStock, gdsDes, gdsImg, gdsDate
		FROM goods g
		INNER JOIN goods_category c
		ON g.cateCode = c.cateCode
		WHERE g.cateCode = #{cateCode}
	</select>
	
	<!-- 조회 -->
	<select id="view" resultType="GoodsViewVo">
		SELECT g.gdsNum, g.gdsName, g.cateCode, c.cateCodeRef, c.cateName, gdsPrice, gdsStock, gdsDes, gdsImg, gdsThumbImg, gdsDate
        FROM goods g
        INNER JOIN goods_category c
        ON g.cateCode = c.cateCode          
        WHERE g.gdsNum = #{gdsNum}
	</select>
	
	<!-- 리뷰 작성 -->
	<insert id="up">
		INSERT INTO reply(gdsNum, userId, repCon)
		VALUES (#{gdsNum}, #{userId}, #{repCon})
	</insert>
	
	<!-- 리뷰 목록 -->
	<select id="reply_list" resultType="ReplyVo">
		SELECT  r.repNum, r.gdsNum, r.userId, r.repCon, r.repDate, a.userName
		FROM reply r
		INNER JOIN account a
		ON r.userId = a.userId
		WHERE gdsNum = #{gdsNum}
	</select>
	
	<!-- 리뷰 수정 -->
	<update id="reply_modify">
		UPDATE reply
		SET repCon = #{repCon}
		WHERE repNum = #{repNum}
		AND userId = #{userId}
	</update>

	<!-- 리뷰 삭제 -->
	<delete id="reply_delete">
		DELETE FROM reply
		WHERE repNum = #{repNum}
		AND userId = #{userId}
	</delete>
	
	<select id="reply_idCheck" resultType="String">
		SELECT userId
		FROM reply
		WHERE repNum = #{repNum}
	</select>
	
	<!-- 카트 담기 -->
	<insert id="cart_add">
		INSERT INTO cart(userId, gdsNum, cartStock)
		VALUES (#{userId}, #{gdsNum}, #{cartStock});
	</insert>
	
	<!-- 카트 -->
	<select id="cart_list" resultType="CartVo">
		SELECT ROW_NUMBER() OVER(ORDER BY c.cartNum DESC) AS num, c.cartNum, c.userId, c.gdsNum, c.cartStock, c.addDate,
		g.gdsNum, g.gdsPrice, g.gdsThumbImg
		FROM cart c
		INNER JOIN goods g
		ON c.gdsNum = g.gdsNum
		WHERE c.userId = #{userId}
	</select>
</mapper>