<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mAdmin">

	<!-- 카테고리 호출 -->
	<select id="category" resultType="CategoryVo">
		WITH recursive cte AS (
		SELECT cateName, cateCode, cateCodeRef, 1 AS level
		FROM mall.goods_category
		WHERE cateCodeRef IS null
		UNION all
		SELECT g.cateName, g.cateCode, g.cateCodeRef, 1 + LEVEL AS level
		FROM mall.goods_category g
		INNER JOIN cte
		ON g.cateCodeRef = cte.cateCode
		)
		SELECT cateName, cateCode, cateCodeRef, LEVEL FROM cte;
	</select>
	
	<!-- 상품 등록 -->
	<insert id="up">
		INSERT INTO goods (gdsName, cateCode, gdsPrice, gdsStock, gdsDes)
     	VALUES (#{gdsName}, #{cateCode}, #{gdsPrice}, #{gdsStock}, #{gdsDes})
	</insert>
	
	<!-- 상품 목록 -->
	<select id="list" resultType="GoodsVo">
		SELECT gdsNum, gdsName, cateCode, gdsPrice, gdsStock, gdsDes, gdsImg, gdsDate
    	FROM goods
        ORDER BY gdsNum desc
	</select>
	
	<!-- 상품 정보 -->
	<select id="view" resultType="GoodsVo">
		SELECT gdsNum, gdsName, cateCode, gdsPrice, gdsStock, gdsDes, gdsImg, gdsDate
     	FROM goods
        WHERE gdsNum = #{gdsNum}
	</select>
</mapper>